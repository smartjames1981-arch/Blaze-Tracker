let seconds = 0;
let timerInterval;
let isRunning = false;
let score = 0;

// Initial Madison Blaze Roster
let players = [
    { name: "Quinn", time: 0, goals: 0, onField: false },
    { name: "Cole", time: 0, goals: 0, onField: false },
    { name: "MJ", time: 0, goals: 0, onField: false },
    { name: "Laiken", time: 0, goals: 0, onField: false },
    { name: "Micah", time: 0, goals: 0, onField: false },
    { name: "Caleb", time: 0, goals: 0, onField: false },
    { name: "Ethan", time: 0, goals: 0, onField: false }
];

let fieldSlots = { st: null, lw: null, mf: null, rw: null, cb1: null, cb2: null, gk: null };

function renderBench() {
    const list = document.getElementById('benchList');
    list.innerHTML = '';
    
    // 1. ADD PLAYER BUTTON (New Feature)
    const addBtn = document.createElement('div');
    addBtn.className = 'player-card';
    addBtn.style.border = '1px dashed #777';
    addBtn.innerHTML = '<span>+ Add Player</span>';
    addBtn.onclick = addNewPlayer;
    list.appendChild(addBtn);

    players.forEach((p, index) => {
        if (!p.onField) {
            const card = document.createElement('div');
            card.className = 'player-card';
            card.innerHTML = `<span>${p.name} ${"âš½".repeat(p.goals)}</span><span class="playing-time">${formatTime(p.time)}</span>`;
            list.appendChild(card);
        }
    });
}

function addNewPlayer() {
    const name = prompt("Enter player name:");
    if (name) {
        players.push({ name: name, time: 0, goals: 0, onField: false });
        renderBench();
    }
}

// 2. FIELD-FIRST SELECTION (New Feature)
function handleFieldClick(slotId) {
    if (fieldSlots[slotId]) {
        // If someone is there, ask: Goal or Sub Out?
        const action = prompt(`Type 'G' for Goal or 'S' to Sub Out ${fieldSlots[slotId].name}:`).toUpperCase();
        if (action === 'G') {
            fieldSlots[slotId].goals++;
            score++;
            document.getElementById('score').innerText = score;
        } else if (action === 'S') {
            fieldSlots[slotId].onField = false;
            fieldSlots[slotId] = null;
            document.getElementById(`name-${slotId}`).innerText = "EMPTY";
        }
    } else {
        // If slot is empty, show available bench players
        const available = players.filter(p => !p.onField);
        if (available.length === 0) return alert("No players on the bench!");

        let menu = "Select player index:\n";
        available.forEach((p, i) => menu += `${i}: ${p.name}\n`);
        
        const choice = prompt(menu);
        if (choice !== null && available[choice]) {
            const selectedPlayer = available[choice];
            selectedPlayer.onField = true;
            fieldSlots[slotId] = selectedPlayer;
            document.getElementById(`name-${slotId}`).innerText = selectedPlayer.name;
        }
    }
    renderBench();
}

// Update the onclick in your HTML <div> tags to use handleFieldClick('st'), etc.
